---
title: "Combined plots"
author: "Chenyu"
date: "2024/01/05"
output:
  html_document:
  toc: yes
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}

# for knitting
knitr::opts_chunk$set(echo = TRUE)
```

# 0 Initial setting

## 0.1 clear workspacce and set default color

```{r reset, include=FALSE}
graphics.off()
rm(list=ls(all.names=TRUE))
options(digits = 3)
options(ggplot2.discrete.colour= c("#615F63","#FF7F6F","#2F7FC1","#FFBE7A","#8FC0A9","#8A1C56"))
options(ggplot2.discrete.fill= c("#615F63","#FF7F6F","#2F7FC1","#FFBE7A","#8FC0A9","#8A1C56"))
```

## 0.2 Packages, theme setting and path

```{r primary setting, include=FALSE}

# library package
packages = c("tidyverse","ggpubr","tidybayes")
suppressMessages(sapply(packages, library, character.only = TRUE))

# import private functions (do not print the output)
nothing <- sapply(list.files("./functions", pattern = "*.R", full.names = TRUE), source)

# theme
theme_set(theme_bw(base_size = 11))
dodge1 = position_dodge(.1)
dodge2 = position_dodge(.2)
dodge3 = position_dodge(.3)
dodge4 = position_dodge(.4)


# task name
data_path <- "./figures/figures-Data/"
figure_path <- "./figures/figures-Parameters/"

# check whether the folders are existent or not. If not, create a new one
dir.create(file.path(figure_path), showWarnings = FALSE)

```

# 0 Load data

```{r}

# Experiment 1
Post_Exp1_M3_initial <- str_glue("{data_path}Post_Exp1_M3_initial.rds") %>% readRDS()
Post_Exp2_M3_initial <- str_glue("{data_path}Post_Exp2_M3_initial.rds") %>% readRDS()



```


# Experiment 1

## Data preparation
```{r}

Table_Exp1_M3 <- Post_Exp1_M3_initial %>% 
  select(.chain, .iteration, .draw, condition, a1, a2, c1, c2, ra, rc) %>% 
  pivot_longer(cols = c(a1, a2, c1, c2, ra, rc), names_to = "coef", values_to = "post") %>% 
  filter(
   post > quantile(post, 0.005),
   post < quantile(post, 0.995),
   .by = c(condition, coef)
  ) %>% 
  labelCondition()


```

## Removal parameters

```{r}

Plot_Exp1_r <- Table_Exp1_M3 %>%
  filter(coef %in% c("ra","rc")) %>% 
  mutate(coef = factor(
    coef,
    levels = c("ra","rc"),
    labels = c("Item memory", "Binding memory")
  )) %>% 
  ggplot(aes(x = condition, y = post, fill = condition)) +
  gghalves::geom_half_violin(side = "l", nudge = 0.1, trim = TRUE) +
  stat_summary(fun.data = median_hdi, show.legend = FALSE)+
  facet_wrap(~ coef)+
  labs(fill = "Condition")+
  ylim(0,1)+
  theme(
    axis.text = element_text(size = 11),
    strip.text = element_text(size = 10.5),
    axis.title = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank())

ggsave(
  plot = Plot_Exp1_r,
  path = figure_path,
  filename = "Plot_Exp1_M3_r.pdf",
  width = 8, height = 4
)

```

## 2 Memory parameters

```{r}

Plot_Exp1_M3_a <- Table_Exp1_M3 %>%
  filter(coef %in% c("a1", "a2")) %>% 
  mutate(coef = factor(
    coef,
    levels = c("a1","a2"),
    labels = c("Original items", "New items")
  )) %>% 
  ggplot(aes(x = condition, y = post, fill = condition)) +
  gghalves::geom_half_violin(side = "l", nudge = 0.1) +
  stat_summary(fun.data = median_hdi, show.legend = FALSE)+
  labs(title = "Item memory", tag = "A", fill = "Condition")+
  ylim(0,5)+
  facet_grid( ~ coef)+
  theme(
    legend.position = "inside",
    legend.justification = c(1,1),
    legend.position.inside = c(0.98,0.98),
    axis.title = element_blank(),
    axis.text = element_text(size = 11),
    strip.text = element_text(size = 10.5),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank())


Plot_Exp1_M3_c <- Table_Exp1_M3 %>%
  filter(coef %in% c("c1", "c2")) %>% 
  mutate(coef = factor(
    coef,
    levels = c("c1","c2"),
    labels = c("Original items", "New items")
  )) %>% 
  ggplot(aes(x = condition, y = post, fill = condition)) +
  gghalves::geom_half_violin(side = "l", nudge = 0.1) +
  stat_summary(fun.data = median_hdi, show.legend = FALSE)+
  labs(title = "Binding memory", tag = "B")+
  ylim(0,5)+
  facet_grid( ~ coef)+
  theme(
    legend.position = "none",
    axis.title = element_blank(),
    axis.text = element_text(size = 11),
    strip.text = element_text(size = 10.5),
    axis.ticks.y = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank())

Plot_Exp1_M3_ac <- ggarrange(Plot_Exp1_M3_a, Plot_Exp1_M3_c, common.legend = FALSE)

ggsave(
  plot = Plot_Exp1_M3_ac,
  path = figure_path,
  filename = "Plot_Exp1_M3_ac.pdf",
  width = 10, height = 4
)

```

# Experiment 2

## Data preparation
```{r}

Table_Exp2_M3 <- Post_Exp2_M3_initial %>% 
  select(.chain, .iteration, .draw, t, a1, a2, c1, c2, ra, rc) %>% 
  pivot_longer(cols = c(a1, a2, c1, c2, ra, rc), names_to = "coef", values_to = "post") %>% 
  filter(
   post > quantile(post, 0.005),
   post < quantile(post, 0.995),
   .by = c(t, coef)
  )


```

## Removal parameters

```{r}

Plot_Exp2_r <- Table_Exp2_M3 %>%
  filter(coef %in% c("ra","rc")) %>% 
  mutate(coef = factor(
    coef,
    levels = c("ra","rc"),
    labels = c("Item memory", "Binding memory")
  )) %>% 
  ggplot(aes(x = t, y = post, fill = t)) +
  gghalves::geom_half_violin(side = "l", nudge = 0.1, trim = TRUE) +
  stat_summary(fun.data = median_hdi, show.legend = FALSE)+
  facet_wrap(~ coef)+
  labs(fill = "Condition")+
  ylim(0,1)+
  theme(
    axis.text = element_text(size = 11),
    strip.text = element_text(size = 10.5),
    axis.title = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank())

ggsave(
  plot = Plot_Exp2_r,
  path = figure_path,
  filename = "Plot_Exp1_M3_r.pdf",
  width = 8, height = 4
)

```

## 2 Memory parameters

```{r}

Plot_Exp2_M3_a <- Table_Exp2_M3 %>%
  filter(coef %in% c("a1", "a2")) %>% 
  mutate(coef = factor(
    coef,
    levels = c("a1","a2"),
    labels = c("Original items", "New items")
  )) %>% 
  ggplot(aes(x = t, y = post, fill = t)) +
  gghalves::geom_half_violin(side = "l", nudge = 0.1) +
  stat_summary(fun.data = median_hdi, show.legend = FALSE)+
  labs(title = "Item memory", tag = "A", fill = "Condition")+
  # ylim(0,5)+
  facet_grid( ~ coef)+
  theme(
    legend.position = "inside",
    legend.justification = c(1,1),
    legend.position.inside = c(0.98,0.98),
    axis.title = element_blank(),
    axis.text = element_text(size = 11),
    strip.text = element_text(size = 10.5),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank())


Plot_Exp2_M3_c <- Table_Exp2_M3 %>%
  filter(coef %in% c("c1", "c2")) %>% 
  mutate(coef = factor(
    coef,
    levels = c("c1","c2"),
    labels = c("Original items", "New items")
  )) %>% 
  ggplot(aes(x = t, y = post, fill = t)) +
  gghalves::geom_half_violin(side = "l", nudge = 0.1) +
  stat_summary(fun.data = median_hdi, show.legend = FALSE)+
  labs(title = "Binding memory", tag = "B")+
  # ylim(0,5)+
  facet_grid( ~ coef)+
  theme(
    legend.position = "none",
    axis.title = element_blank(),
    axis.text = element_text(size = 11),
    strip.text = element_text(size = 10.5),
    axis.ticks.y = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank())

Plot_Exp1_M3_ac <- ggarrange(Plot_Exp1_M3_a, Plot_Exp1_M3_c, common.legend = FALSE)

ggsave(
  plot = Plot_Exp1_M3_ac,
  path = figure_path,
  filename = "Plot_Exp1_M3_ac.pdf",
  width = 10, height = 4
)

```